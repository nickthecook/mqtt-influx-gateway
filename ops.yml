dependencies:
  dir:
    - log
  docker:
    - deps/telegraf
  brew:
    - mosquitto
  custom:
    - bundle
forwards:
  tg: deps/telegraf
actions:
  server:
    command: bin/mig
  watch:
    command: rerun ops server
  latest-gem-file:
    command: ls -t mqtt-influx-gateway-*.gem | head -n 1
    alias: latest
  build:
    command: gem build *.gemspec
    alias: b
  install:
    command: gem i `ops latest-gem-file`
    alias: i
  build-and-install:
    command: ops build && ops install
    alias: bi
  test:
    command: bundle exec rspec
    alias: t
  test-watch:
    command: bundle exec rerun -xqb rspec
    alias: tw
  pub:
    command: mosquitto_pub -h "$BROKER" -t "$TEST_TOPIC" -m
options:
  environment:
    BROKER: mqtt
    TEST_TOPIC: /home/ping/mig_test_1

